<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cluster Overview</title>
    <link id="theme-stylesheet" rel="stylesheet" href="{{ url_for('static', filename='theme_glass.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body>
    <header>
        <h1>Cluster Monitor</h1>
        <div class="status-bar">
            View: <a href="{{ url_for('overview_page') }}"
                class="{{ 'active-view' if current_view == 'overview' else '' }}">Overview</a> |
            <a href="{{ url_for('detailed_page') }}"
                class="{{ 'active-view' if current_view == 'detailed' else '' }}">Detailed</a> |
            <a href="{{ url_for('docker_page') }}"
                class="{{ 'active-view' if current_view == 'docker' else '' }}">Docker</a>
            <span style="margin-left: 20px;">Last Updated: <span id="lastUpdated">Never</span></span>
            <span style="margin-left: 10px;">Auto-Refresh: <span id="refreshStatus">ON</span>
                (<a href="#" id="toggleRefresh">Toggle</a>)</span>
            <span style="margin-left: 10px;">
                Interval (s): <input type="number" id="refreshIntervalInput" value="15" min="1" max="300"
                    style="width: 50px; padding: 1px 3px;">
            </span>
            <span style="margin-left: 10px;">
                Theme: <select id="themeSelect" style="padding: 2px;">
                    <option value="glass">Glass (Dark)</option>
                    <option value="classic">Classic (Light)</option>
                </select>
            </span>
            {% if remote_user %}
            <span style="margin-left: 20px;">
                User: <strong>{{ remote_user }}</strong>
            </span>
            {% endif %}
            <button id="reloadConfigBtn" style="margin-left:10px;">Reload Config</button>
        </div>
    </header>

    <main id="dashboardContainer" class="overview-container">
        <p id="loadingMessage">Loading data for configured hosts...</p>
    </main>

    <footer>
        <p>Monitoring Dashboard</p>
    </footer>

    <script id="initial-hosts-config" type="application/json">
        {{ initial_hosts_config | tojson | safe }}
    </script>
    <script src="{{ url_for('static', filename='notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        const initialConfigEl = document.getElementById('initial-hosts-config');
        let initialHostsConfig = [];
        if (initialConfigEl && initialConfigEl.textContent.trim()) {
            try {
                initialHostsConfig = JSON.parse(initialConfigEl.textContent);
            } catch (err) {
                console.error('Failed to parse initial host configuration JSON.', err);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard(initialHostsConfig, 'overview');
        });
    </script>
</body>

</html>